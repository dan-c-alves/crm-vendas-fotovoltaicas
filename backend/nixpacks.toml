providers = ["python"]

[phases.setup]
# Use a Python build that already includes pip
nixPkgs = ["python311Full"]

[phases.install]
cmds = [
  # Se pip3 não existir, tenta habilitar via ensurepip (ignora erro)
  "command -v pip3 >/dev/null 2>&1 || python -m ensurepip --upgrade || true",
  # Atualiza ferramentas de build, usando python -m pip ou fallback pip3
  "python -m pip install --upgrade pip setuptools wheel || pip3 install --upgrade pip setuptools wheel",
  # Instalar dependências do projeto com fallback
  "python -m pip install -r requirements.txt || pip3 install -r requirements.txt"
]

[start]
cmd = "uvicorn main:app --host 0.0.0.0 --port $PORT"
